<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="662px" preserveAspectRatio="none" style="width:756px;height:662px;background:#FFFFFF;" version="1.1" viewBox="0 0 756 662" width="756px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jyfgm49l26j6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="146" x2="146" y1="53.4883" y2="605.0781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="515" x2="515" y1="53.4883" y2="605.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="116" y="50.5352">Initiator</text><ellipse cx="146" cy="21" fill="#FEFECE" filter="url(#f1jyfgm49l26j6)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="134" x2="158" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="116" y="617.6133">Initiator</text><ellipse cx="146" cy="636.5664" fill="#FEFECE" filter="url(#f1jyfgm49l26j6)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="134" x2="158" y1="650.5664" y2="650.5664"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="475" y="50.5352">Responder</text><ellipse cx="515" cy="21" fill="#FEFECE" filter="url(#f1jyfgm49l26j6)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="503" x2="527" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="475" y="617.6133">Responder</text><ellipse cx="515" cy="636.5664" fill="#FEFECE" filter="url(#f1jyfgm49l26j6)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="503" x2="527" y1="650.5664" y2="650.5664"/><path d="M407,68.4883 L407,93.4883 L619,93.4883 L619,78.4883 L609,68.4883 L407,68.4883 " fill="#FBFB77" filter="url(#f1jyfgm49l26j6)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M609,68.4883 L609,78.4883 L619,78.4883 L609,68.4883 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="413" y="86.0566">Stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="478" y="86.0566">is closed for writing</text><rect fill="#EEEEEE" filter="url(#f1jyfgm49l26j6)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="749" x="0" y="123.4541"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="749" y1="123.4541" y2="123.4541"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="749" y1="126.4541" y2="126.4541"/><rect fill="#EEEEEE" filter="url(#f1jyfgm49l26j6)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="134" x="307.5" y="112.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="313.5" y="129.3672">Stream Migration</text><path d="M113,151.1094 L113,176.1094 L547,176.1094 L547,161.1094 L537,151.1094 L113,151.1094 " fill="#FBFB77" filter="url(#f1jyfgm49l26j6)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M537,151.1094 L537,161.1094 L547,161.1094 L537,151.1094 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="227.5" y="168.6777">Migrate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="278.5" y="168.6777">Stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="343.5" y="168.6777">to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="360.5" y="168.6777">Stream B</text><polygon fill="#A80036" points="503,202.7305,513,206.7305,503,210.7305,507,206.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="509" y1="206.7305" y2="206.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="160.5" y="201.9883">Stream A:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="228.5" y="201.9883">Start stream migration, this stream is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="467.5" y="201.9883">id=A</text><polygon fill="#A80036" points="503,232.041,513,236.041,503,240.041,507,236.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="509" y1="236.041" y2="236.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="158" y="231.2988">Open new stream on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="291" y="231.2988">Connection 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="380" y="231.2988">. Call this</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="444" y="231.2988">Stream B</text><polygon fill="#A80036" points="503,261.3516,513,265.3516,503,269.3516,507,265.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="509" y1="265.3516" y2="265.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62" x="170.5" y="260.6094">Stream B:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="236.5" y="260.6094">Migrate stream with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="365.5" y="260.6094">id=A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="402.5" y="260.6094">to this stream</text><polygon fill="#A80036" points="157,290.6621,147,294.6621,157,298.6621,153,294.6621" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="151" x2="514" y1="294.6621" y2="294.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62" x="260" y="289.9199">Stream B:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="326" y="289.9199">Ack Migrate</text><path d="M5,307.6621 L5,347.6621 L283,347.6621 L283,317.6621 L273,307.6621 L5,307.6621 " fill="#FBFB77" filter="url(#f1jyfgm49l26j6)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M273,307.6621 L273,317.6621 L283,317.6621 L273,307.6621 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="11" y="325.2305">Close</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="50" y="325.2305">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="115" y="325.2305">for writing.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="11" y="340.541">Will only write to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="121" y="340.541">stream B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="184" y="340.541">from now on.</text><path d="M19,362.2832 L19,417.2832 L269,417.2832 L269,372.2832 L259,362.2832 L19,362.2832 " fill="#FBFB77" filter="url(#f1jyfgm49l26j6)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M259,362.2832 L259,372.2832 L269,372.2832 L259,362.2832 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="25" y="379.8516">We have already seen the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="186" y="379.5278">EOF</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="214" y="379.8516">on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="25" y="395.1621">Stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="90" y="395.1621">from</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="66" x="124" y="395.1621">Responder</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="25" y="410.4727">So we continue reading on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="195" y="410.4727">stream B</text><polygon fill="#A80036" points="503,444.5254,513,448.5254,503,452.5254,507,448.5254" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="509" y1="448.5254" y2="448.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="284.5" y="443.7832">Stream A:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="352.5" y="443.7832"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="352.5" y="443.4595">EOF</text><path d="M286,461.5254 L286,516.5254 L740,516.5254 L740,471.5254 L730,461.5254 L286,461.5254 " fill="#FBFB77" filter="url(#f1jyfgm49l26j6)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M730,461.5254 L730,471.5254 L740,471.5254 L730,461.5254 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="292" y="479.0938">Treat</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="328" y="478.77">EOF</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="356" y="479.0938">on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="376" y="479.0938">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="441" y="479.0938">as a signal to close</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="566" y="479.0938">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="631" y="479.0938">for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="292" y="494.4043">writing and continue writing on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="494" y="494.4043">stream B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="553" y="494.4043">. However stream A was</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="292" y="509.7148">already closed (before migration), so we close</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="584" y="509.7148">stream B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="647" y="509.7148">as well here.</text><polygon fill="#A80036" points="157,543.7676,147,547.7676,157,551.7676,153,547.7676" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="151" x2="514" y1="547.7676" y2="547.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62" x="285.5" y="543.0254">Stream B:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="351.5" y="543.0254"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="351.5" y="542.7017">EOF</text><path d="M113,560.7676 L113,585.7676 L547,585.7676 L547,570.7676 L537,560.7676 L113,560.7676 " fill="#FBFB77" filter="url(#f1jyfgm49l26j6)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M537,560.7676 L537,570.7676 L547,570.7676 L537,560.7676 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="205.5" y="578.3359">Stream A is now migrated to Stream B</text><!--MD5=[ee6e312a89605e4afb672e46d6d0631c]
@startuml stream-migration-half-closed
skinparam sequenceMessageAlign center
entity Initiator
entity Responder

note over Responder: <b>Stream A</b> is closed for writing

== Stream Migration ==

note over Initiator, Responder: Migrate <b>Stream A</b> to <b>Stream B</b>

Initiator -> Responder: <b>Stream A:</b> Start stream migration, this stream is <b>id=A</b>

Initiator -> Responder: Open new stream on <b>Connection 2</b>. Call this <b>Stream B</b>

Initiator -> Responder: <b>Stream B:</b> Migrate stream with <b>id=A</b> to this stream
Initiator <- Responder: <b>Stream B:</b> Ack Migrate

note over Initiator
    Close <b>stream A</b> for writing.
    Will only write to <b>stream B</b> from now on.
end note


note over Initiator
    We have already seen the ""EOF"" on
    <b>Stream A</b> from <i>Responder</i>
    So we continue reading on <b>stream B</b>
end note

Initiator -> Responder: <b>Stream A:</b> ""EOF""

note over Responder
    Treat ""EOF"" on <b>stream A</b> as a signal to close <b>stream A</b> for
    writing and continue writing on <b>stream B</b>. However stream A was
    already closed (before migration), so we close <b>stream B</b> as well here.
end note
Initiator <- Responder: <b>Stream B:</b> ""EOF""


note over Initiator, Responder: Stream A is now migrated to Stream B
@enduml

PlantUML version 1.2021.12(Tue Oct 05 09:01:58 PDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>