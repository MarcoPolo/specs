<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="791px" preserveAspectRatio="none" style="width:688px;height:791px;background:#FFFFFF;" version="1.1" viewBox="0 0 688 791" width="688px" zoomAndPan="magnify"><defs><filter height="300%" id="f6gg6yevf5956" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="156" x2="156" y1="53.4883" y2="733.6309"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="525" x2="525" y1="53.4883" y2="733.6309"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="126" y="50.5352">Initiator</text><ellipse cx="156" cy="21" fill="#FEFECE" filter="url(#f6gg6yevf5956)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="144" x2="168" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="126" y="746.166">Initiator</text><ellipse cx="156" cy="765.1191" fill="#FEFECE" filter="url(#f6gg6yevf5956)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="144" x2="168" y1="779.1191" y2="779.1191"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="485" y="50.5352">Responder</text><ellipse cx="525" cy="21" fill="#FEFECE" filter="url(#f6gg6yevf5956)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="513" x2="537" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="485" y="746.166">Responder</text><ellipse cx="525" cy="765.1191" fill="#FEFECE" filter="url(#f6gg6yevf5956)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="513" x2="537" y1="779.1191" y2="779.1191"/><path d="M123,68.4883 L123,93.4883 L557,93.4883 L557,78.4883 L547,68.4883 L123,68.4883 " fill="#FBFB77" filter="url(#f6gg6yevf5956)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M547,68.4883 L547,78.4883 L557,78.4883 L547,68.4883 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="235" y="86.0566">Assume at least 2 connections.</text><polygon fill="#A80036" points="167,120.1094,157,124.1094,167,128.1094,163,124.1094" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="513,120.1094,523,124.1094,513,128.1094,517,124.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="161" x2="519" y1="124.1094" y2="124.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="157" x="262" y="119.3672">Connection 1; stream A</text><polygon fill="#A80036" points="167,149.4199,157,153.4199,167,157.4199,163,153.4199" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="513,149.4199,523,153.4199,513,157.4199,517,153.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="161" x2="519" y1="153.4199" y2="153.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="296" y="148.6777">Connection 2</text><rect fill="#EEEEEE" filter="url(#f6gg6yevf5956)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="681" x="0" y="182.0752"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="681" y1="182.0752" y2="182.0752"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="681" y1="185.0752" y2="185.0752"/><rect fill="#EEEEEE" filter="url(#f6gg6yevf5956)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="134" x="273.5" y="171.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="279.5" y="187.9883">Stream Migration</text><path d="M123,209.7305 L123,234.7305 L557,234.7305 L557,219.7305 L547,209.7305 L123,209.7305 " fill="#FBFB77" filter="url(#f6gg6yevf5956)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M547,209.7305 L547,219.7305 L557,219.7305 L547,209.7305 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="237.5" y="227.2988">Migrate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="288.5" y="227.2988">Stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="353.5" y="227.2988">to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="370.5" y="227.2988">Stream B</text><polygon fill="#A80036" points="513,261.3516,523,265.3516,513,269.3516,517,265.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="156" x2="519" y1="265.3516" y2="265.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="170.5" y="260.6094">Stream A:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="238.5" y="260.6094">Start stream migration, this stream is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="477.5" y="260.6094">id=A</text><polygon fill="#A80036" points="513,290.6621,523,294.6621,513,298.6621,517,294.6621" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="156" x2="519" y1="294.6621" y2="294.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="168" y="289.9199">Open new stream on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="301" y="289.9199">Connection 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="390" y="289.9199">. Call this</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="454" y="289.9199">Stream B</text><polygon fill="#A80036" points="513,319.9727,523,323.9727,513,327.9727,517,323.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="156" x2="519" y1="323.9727" y2="323.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62" x="180.5" y="319.2305">Stream B:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="246.5" y="319.2305">Migrate stream with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="375.5" y="319.2305">id=A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="412.5" y="319.2305">to this stream</text><polygon fill="#A80036" points="167,349.2832,157,353.2832,167,357.2832,163,353.2832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="161" x2="524" y1="353.2832" y2="353.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62" x="270" y="348.541">Stream B:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="336" y="348.541">Ack Migrate</text><path d="M373,366.2832 L373,406.2832 L672,406.2832 L672,376.2832 L662,366.2832 L373,366.2832 " fill="#FBFB77" filter="url(#f6gg6yevf5956)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M662,366.2832 L662,376.2832 L672,376.2832 L662,366.2832 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="379" y="383.8516">Treat any</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="441" y="383.5278">EOF</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="469" y="383.8516">on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="489" y="383.8516">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="554" y="383.8516">as a signal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="379" y="399.1621">that it should continue reading on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="598" y="399.1621">stream B</text><path d="M15,420.9043 L15,460.9043 L293,460.9043 L293,430.9043 L283,420.9043 L15,420.9043 " fill="#FBFB77" filter="url(#f6gg6yevf5956)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M283,420.9043 L283,430.9043 L293,430.9043 L283,420.9043 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="21" y="438.4727">Close</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="60" y="438.4727">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="125" y="438.4727">for writing.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="21" y="453.7832">Will only write to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="131" y="453.7832">stream B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="194" y="453.7832">from now on.</text><polygon fill="#A80036" points="513,487.8359,523,491.8359,513,495.8359,517,491.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="156" x2="519" y1="491.8359" y2="491.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="294.5" y="487.0938">Stream A:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="362.5" y="487.0938"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="362.5" y="486.77">EOF</text><path d="M378,504.8359 L378,559.8359 L668,559.8359 L668,514.8359 L658,504.8359 L378,504.8359 " fill="#FBFB77" filter="url(#f6gg6yevf5956)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M658,504.8359 L658,514.8359 L668,514.8359 L658,504.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="384" y="522.4043">When</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="66" x="422" y="522.4043">Responder</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="492" y="522.4043">reads</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="530" y="522.0806">EOF</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="558" y="522.4043">on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="578" y="522.4043">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="384" y="537.7148">it will close</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="460" y="537.7148">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="525" y="537.7148">for writing.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="384" y="553.0254">It will only write to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="506" y="553.0254">stream B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="569" y="553.0254">from now on.</text><polygon fill="#A80036" points="167,587.0781,157,591.0781,167,595.0781,163,591.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="161" x2="524" y1="591.0781" y2="591.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="294.5" y="586.3359">Stream A:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="362.5" y="586.3359"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="362.5" y="586.0122">EOF</text><path d="M5,604.0781 L5,644.0781 L304,644.0781 L304,614.0781 L294,604.0781 L5,604.0781 " fill="#FBFB77" filter="url(#f6gg6yevf5956)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M294,604.0781 L294,614.0781 L304,614.0781 L294,604.0781 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="11" y="621.6465">Treat any</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="73" y="621.3228">EOF</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="101" y="621.6465">on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="121" y="621.6465">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="186" y="621.6465">as a signal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="11" y="636.957">that it should continue reading on</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="230" y="636.957">stream B</text><path d="M123,658.6992 L123,713.6992 L557,713.6992 L557,668.6992 L547,658.6992 L123,658.6992 " fill="#FBFB77" filter="url(#f6gg6yevf5956)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M547,658.6992 L547,668.6992 L557,668.6992 L547,658.6992 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="183.5" y="676.2676">At this point</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="266.5" y="676.2676">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="331.5" y="676.2676">is closed for writing on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="183.5" y="691.5781">both sides, and both sides have read up to</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="455.5" y="691.2544">EOF</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="479.5" y="691.5781">.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="183.5" y="706.8887">stream A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="248.5" y="706.8887">has been fully migrated to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="417.5" y="706.8887">stream B</text><!--MD5=[76345f8c65f6f08ea426cd1ed6fc43e6]
@startuml stream-migration
skinparam sequenceMessageAlign center
entity Initiator
entity Responder

note over Initiator, Responder: Assume at least 2 connections.

Initiator <-> Responder: <b>Connection 1; stream A</b>
Initiator <-> Responder: <b>Connection 2</b>

== Stream Migration ==

note over Initiator, Responder: Migrate <b>Stream A</b> to <b>Stream B</b>

Initiator -> Responder: <b>Stream A:</b> Start stream migration, this stream is <b>id=A</b>

Initiator -> Responder: Open new stream on <b>Connection 2</b>. Call this <b>Stream B</b>

Initiator -> Responder: <b>Stream B:</b> Migrate stream with <b>id=A</b> to this stream
Initiator <- Responder: <b>Stream B:</b> Ack Migrate

note over Responder
    Treat any ""EOF"" on <b>stream A</b> as a signal
    that it should continue reading on <b>stream B</b>
end note


note over Initiator
    Close <b>stream A</b> for writing.
    Will only write to <b>stream B</b> from now on.
end note

Initiator -> Responder: <b>Stream A:</b> ""EOF""

note over Responder
    When <i>Responder</i> reads ""EOF"" on <b>stream A</b>
    it will close <b>stream A</b> for writing.
    It will only write to <b>stream B</b> from now on.
end note

Initiator <- Responder: <b>Stream A:</b> ""EOF""

note over Initiator
    Treat any ""EOF"" on <b>stream A</b> as a signal
    that it should continue reading on <b>stream B</b>
end note

note over Initiator, Responder
    At this point <b>stream A</b> is closed for writing on
    both sides, and both sides have read up to ""EOF"".
    <b>stream A</b> has been fully migrated to <b>stream B</b>
end note

@enduml

PlantUML version 1.2021.12(Tue Oct 05 09:01:58 PDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>